---
name: doc-updater
description: ë¡œë“œë§µ/ì²´í¬ë¦¬ìŠ¤íŠ¸ ë¬¸ì„œì˜ ì§„í–‰ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ê³ , íƒœìŠ¤í¬/Phase ì™„ë£Œ ì‹œ ìƒì„¸ êµ¬í˜„ ë¬¸ì„œë¥¼ ìƒì„±í•˜ëŠ” ìŠ¤í‚¬. (1) íƒœìŠ¤í¬ ì™„ë£Œ í›„ "ì²´í¬ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸í•´ì¤˜", "ì™„ë£Œ í‘œì‹œí•´ì¤˜" ìš”ì²­ ì‹œ, (2) ì§„í–‰ë¥  ê°±ì‹ ì´ í•„ìš”í•  ë•Œ, (3) Phase ì™„ë£Œ ì‹œ **docs/implemented/**ì— êµ¬í˜„ ë§¤ë‰´ì–¼ ì‘ì„± ì‹œ íŠ¸ë¦¬ê±°.
---

# Doc Updater

ë¡œë“œë§µ ë° ì²´í¬ë¦¬ìŠ¤íŠ¸ ë¬¸ì„œì˜ ì§„í–‰ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ê³ , ì™„ë£Œëœ êµ¬í˜„ì— ëŒ€í•œ ìƒì„¸ ë§¤ë‰´ì–¼ ë¬¸ì„œë¥¼ ìƒì„±í•œë‹¤.

## í•µì‹¬ ê¸°ëŠ¥

### 1. ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒíƒœ ë³€ê²½
```markdown
ë³€ê²½ ì „: - [ ] íƒœìŠ¤í¬ 1
ë³€ê²½ í›„: - [x] íƒœìŠ¤í¬ 1
```

### 2. ì§„í–‰ë¥  ìë™ ê³„ì‚°
```markdown
ë³€ê²½ ì „: Phase D: [ì¿¼ë¦¬ ìµœì í™”] â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0%
ë³€ê²½ í›„: Phase D: [ì¿¼ë¦¬ ìµœì í™”] â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 40%
```

### 3. ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
```markdown
ë³€ê²½ ì „: | D-1. N+1 í•´ê²° | 2ì¼ | â¬œ ëŒ€ê¸° |
ë³€ê²½ í›„: | D-1. N+1 í•´ê²° | 2ì¼ | âœ… ì™„ë£Œ |
```

### 4. ğŸ†• êµ¬í˜„ ë§¤ë‰´ì–¼ ë¬¸ì„œ ìƒì„±
```
docs/implemented/YYYY-MM-DD_íƒœìŠ¤í¬-ë‚´ìš©.md
```

## ì €ì¥ ìœ„ì¹˜

### êµ¬í˜„ ë§¤ë‰´ì–¼ ë¬¸ì„œ
```
docs/implemented/
â”œâ”€â”€ 2026-01-20_phase-a-api-documentation.md
â”œâ”€â”€ 2026-01-25_phase-b-testing.md
â”œâ”€â”€ 2026-01-31_D-1-nplusone-fix.md        â† ê°œë³„ íƒœìŠ¤í¬ ë¬¸ì„œ
â””â”€â”€ 2026-02-01_phase-d-query-optimization.md  â† Phase ì „ì²´ ë¬¸ì„œ
```

### íŒŒì¼ ëª…ëª… ê·œì¹™
```
YYYY-MM-DD_{phase|task}-{ë‚´ìš©}.md

ì˜ˆì‹œ:
- 2026-01-31_D-1-nplusone-fix.md        # ê°œë³„ íƒœìŠ¤í¬
- 2026-02-01_phase-d-query-optimization.md  # Phase ì „ì²´
```

## ì›Œí¬í”Œë¡œìš°

### Step 1: ë¬¸ì„œ ë¡œë“œ
- ë¡œë“œë§µ/ì²´í¬ë¦¬ìŠ¤íŠ¸ íŒŒì¼ ê²½ë¡œ í™•ì¸
- í˜„ì¬ ë¬¸ì„œ ë‚´ìš© íŒŒì‹±

### Step 2: ë³€ê²½ ì‚¬í•­ ì‹ë³„
ì‚¬ìš©ì ìš”ì²­ì—ì„œ íŒŒì•…:
- ì™„ë£Œí•  íƒœìŠ¤í¬/ì„œë¸ŒíƒœìŠ¤í¬
- ìƒíƒœ ë³€ê²½ (ëŒ€ê¸° â†’ ì§„í–‰ì¤‘ â†’ ì™„ë£Œ)
- ì¶”ê°€ ë©”ëª¨/ë…¸íŠ¸

### Step 3: ë¬¸ì„œ ì—…ë°ì´íŠ¸
1. ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë³€ê²½
2. ì§„í–‰ë¥  ì¬ê³„ì‚°
3. ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
4. íƒ€ì„ìŠ¤íƒ¬í”„ ê°±ì‹ 

### Step 4: êµ¬í˜„ ë§¤ë‰´ì–¼ ìƒì„± (íƒœìŠ¤í¬/Phase ì™„ë£Œ ì‹œ)
1. êµ¬í˜„ ë‚´ìš© ì •ë¦¬
2. `docs/implemented/` ë””ë ‰í† ë¦¬ì— ì €ì¥
3. **state.json ì—…ë°ì´íŠ¸** (outputs.implemented ê²½ë¡œ ê¸°ë¡)

### Step 5: ë³€ê²½ ë‚´ì—­ ì¶œë ¥

## êµ¬í˜„ ë§¤ë‰´ì–¼ ë¬¸ì„œ í…œí”Œë¦¿

### ê°œë³„ íƒœìŠ¤í¬ ì™„ë£Œ ì‹œ

```markdown
# [íƒœìŠ¤í¬ID] [íƒœìŠ¤í¬ëª…] êµ¬í˜„ ë¬¸ì„œ

**ì‘ì„±ì¼**: YYYY-MM-DD
**Phase**: [Phaseëª…]
**íƒœìŠ¤í¬**: [íƒœìŠ¤í¬ ID ë° ì„¤ëª…]
**ê´€ë ¨ ì»¤ë°‹**: [ì»¤ë°‹ í•´ì‹œ]
**ê³„íš ë¬¸ì„œ**: [docs/plan/ê²½ë¡œ.md](ë§í¬)

---

## 1. êµ¬í˜„ ê°œìš”

### 1.1 ëª©ì 
- ì´ íƒœìŠ¤í¬ì—ì„œ í•´ê²°í•œ ë¬¸ì œ
- ë‹¬ì„±í•œ ëª©í‘œ

### 1.2 ë²”ìœ„
- ë³€ê²½ëœ íŒŒì¼ ëª©ë¡
- ìƒˆë¡œ ì¶”ê°€ëœ ê¸°ëŠ¥

---

## 2. êµ¬í˜„ ë‚´ìš©

### 2.1 í•µì‹¬ ë³€ê²½ì‚¬í•­

**íŒŒì¼**: `app/services/inventory.py`

**ë³€ê²½ ì „**:
```python
async def get_all_stocks(self):
    result = await self.session.execute(select(CurrentStock))
    return result.scalars().all()
```

**ë³€ê²½ í›„**:
```python
from sqlalchemy.orm import selectinload

async def get_all_stocks(self, include_product: bool = True):
    stmt = select(CurrentStock)
    if include_product:
        stmt = stmt.options(selectinload(CurrentStock.product))
    result = await self.session.execute(stmt)
    return result.scalars().all()
```

**ì„¤ëª…**: selectinloadë¥¼ ì‚¬ìš©í•˜ì—¬ N+1 ì¿¼ë¦¬ ë¬¸ì œ í•´ê²°

### 2.2 ì¶”ê°€ëœ í…ŒìŠ¤íŠ¸

**íŒŒì¼**: `tests/integration/test_inventory_query.py`

```python
async def test_get_stocks_no_nplusone(db_session):
    # N+1 ì¿¼ë¦¬ ë¯¸ë°œìƒ ê²€ì¦
```

---

## 3. ì„¤ê³„ ê²°ì •

| ê²°ì • ì‚¬í•­ | ì„ íƒ | ëŒ€ì•ˆ | ì„ íƒ ì´ìœ  |
|----------|------|------|----------|
| Eager loading | selectinload | joinedload | 1:N ê´€ê³„ì— ì í•© |

---

## 4. ê²€ì¦ ê²°ê³¼

### 4.1 í…ŒìŠ¤íŠ¸ ê²°ê³¼
```
pytest tests/integration/test_inventory_query.py -v
============================
3 passed in 0.5s
============================
```

### 4.2 ì„±ëŠ¥ ê°œì„ 
- **ì¿¼ë¦¬ ìˆ˜**: 11 â†’ 2 (82% ê°ì†Œ)
- **ì‘ë‹µ ì‹œê°„**: 450ms â†’ 120ms (73% ê°œì„ )

---

## 5. ì‚¬ìš© ë°©ë²•

```python
# ì œí’ˆ ì •ë³´ í¬í•¨ ì¡°íšŒ (ê¸°ë³¸)
stocks = await service.get_all_stocks()

# ì œí’ˆ ì •ë³´ ë¯¸í¬í•¨ ì¡°íšŒ
stocks = await service.get_all_stocks(include_product=False)
```

---

## 6. ì°¸ê³  ìë£Œ

- [êµ¬í˜„ ê³„íšì„œ](../plan/2026-01-31_D-1-nplusone-plan.md)
- [SQLAlchemy ë¬¸ì„œ - Eager Loading](https://docs.sqlalchemy.org/en/20/orm/queryguide/relationships.html)
```

### Phase ì™„ë£Œ ì‹œ (í†µí•© ë¬¸ì„œ)

```markdown
# Phase [X]: [Phaseëª…] êµ¬í˜„ ë¬¸ì„œ

**ì‘ì„±ì¼**: YYYY-MM-DD
**ì‘ì„±ì**: [ì´ë¦„]
**Phase ê¸°ê°„**: YYYY-MM-DD ~ YYYY-MM-DD
**ê´€ë ¨ ì»¤ë°‹**: [ì»¤ë°‹ ë²”ìœ„ ë˜ëŠ” ë§í¬]

---

## 1. ê°œìš”

### 1.1 ëª©ì 
- ì´ Phaseì—ì„œ í•´ê²°í•œ ë¬¸ì œ
- ë‹¬ì„±í•œ ëª©í‘œ

### 1.2 ë²”ìœ„
- í¬í•¨ëœ íƒœìŠ¤í¬ ëª©ë¡:
  - [X-1] íƒœìŠ¤í¬ëª…
  - [X-2] íƒœìŠ¤í¬ëª…
  - [X-3] íƒœìŠ¤í¬ëª…
- ì˜í–¥ë°›ëŠ” ëª¨ë“ˆ/íŒŒì¼

---

## 2. êµ¬í˜„ ë‚´ìš©

### 2.1 íƒœìŠ¤í¬ë³„ ìš”ì•½

#### [X-1] íƒœìŠ¤í¬ëª…
- **íŒŒì¼**: `ê²½ë¡œ`
- **í•µì‹¬ ë³€ê²½**: ì„¤ëª…
- **ìƒì„¸ ë¬¸ì„œ**: [ë§í¬](./2026-01-31_X-1-xxx.md)

#### [X-2] íƒœìŠ¤í¬ëª…
- **íŒŒì¼**: `ê²½ë¡œ`
- **í•µì‹¬ ë³€ê²½**: ì„¤ëª…

### 2.2 ì•„í‚¤í…ì²˜ ë³€ê²½

```
[ë³€ê²½ ì „]
Component A â†’ Component B â†’ DB

[ë³€ê²½ í›„]
Component A â†’ Component B â†’ Cache â†’ DB
```

---

## 3. ì„¤ê³„ ê²°ì •

### 3.1 ì£¼ìš” ê²°ì • ì‚¬í•­

| ê²°ì • | ì„ íƒ | ëŒ€ì•ˆ | ì´ìœ  |
|------|------|------|------|
| ìºì‹± ë°©ì‹ | Redis | ì¸ë©”ëª¨ë¦¬ | ë¶„ì‚° í™˜ê²½ ê³ ë ¤ |

### 3.2 íŠ¸ë ˆì´ë“œì˜¤í”„

**ì¥ì **:
- ì¥ì  1
- ì¥ì  2

**ë‹¨ì **:
- ë‹¨ì  1 (ëŒ€ì‘ ë°©ì•ˆ)

---

## 4. í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

### 4.1 í…ŒìŠ¤íŠ¸ ê²°ê³¼
```
Tests: 25 passed
Coverage: 85% (+3%)
```

### 4.2 ì„±ëŠ¥ ì§€í‘œ
| ì§€í‘œ | ì´ì „ | ì´í›„ | ê°œì„ ë¥  |
|------|------|------|--------|
| ì‘ë‹µ ì‹œê°„ (P95) | 450ms | 120ms | 73% |
| ì¿¼ë¦¬ ìˆ˜ | 11 | 2 | 82% |

---

## 5. ë¬¸ì œ í•´ê²°

### 5.1 ë°œìƒí•œ ì´ìŠˆ

| ì´ìŠˆ | ì›ì¸ | í•´ê²° ë°©ë²• |
|------|------|----------|
| ìºì‹œ ë¬´íš¨í™” | ë™ì‹œì„± ë¬¸ì œ | TTL ì„¤ì • |

### 5.2 ë””ë²„ê¹… íŒ
- ë¡œê·¸ ìœ„ì¹˜: `logs/query.log`
- ë””ë²„ê¹… í™˜ê²½ ë³€ìˆ˜: `DEBUG_QUERY=1`

---

## 6. ê²°ë¡ 

### 6.1 ë‹¬ì„± ì‚¬í•­
- ëª©í‘œ 1 âœ…
- ëª©í‘œ 2 âœ…

### 6.2 ë‹¤ìŒ ë‹¨ê³„
- Phase Yì™€ì˜ ì—°ê´€ì„±
- ì¶”ê°€ ê°œì„  ê°€ëŠ¥ ì˜ì—­

---

## 7. ì°¸ê³  ìë£Œ

- [Phase X ë¡œë“œë§µ](../roadmap.md#phase-x)
- [ê³„íš ë¬¸ì„œë“¤](../plan/)
- [API ëª…ì„¸](../api-spec.md)
```

## state.json ì—°ë™

### íƒœìŠ¤í¬ ì™„ë£Œ ì‹œ ì—…ë°ì´íŠ¸

```bash
# êµ¬í˜„ ë¬¸ì„œ ê²½ë¡œ ê¸°ë¡
jq '.phases.D.tasks["D-1"].outputs.implemented = "docs/implemented/2026-01-31_D-1-nplusone-fix.md"' \
   .pipeline/state.json > tmp.json && mv tmp.json .pipeline/state.json

# ìƒíƒœ ì™„ë£Œ ì²˜ë¦¬
jq '.phases.D.tasks["D-1"].status = "completed" | 
    .phases.D.tasks["D-1"].completed_at = "2026-01-31T16:00:00Z"' \
   .pipeline/state.json > tmp.json && mv tmp.json .pipeline/state.json
```

### Phase ì™„ë£Œ ì‹œ ì—…ë°ì´íŠ¸

```bash
# Phase ìƒíƒœ ì™„ë£Œ
jq '.phases.D.status = "completed" | 
    .phases.D.completed_at = "2026-02-01T18:00:00Z"' \
   .pipeline/state.json > tmp.json && mv tmp.json .pipeline/state.json
```

## ì¶œë ¥ í˜•ì‹

### ë³€ê²½ ìš”ì•½ (íƒœìŠ¤í¬ ì™„ë£Œ)

```markdown
## ğŸ“ ë¬¸ì„œ ì—…ë°ì´íŠ¸ ì™„ë£Œ

**íŒŒì¼**: `docs/roadmap.md`
**ì‹œê°„**: 2026-01-31 16:00

### ë³€ê²½ ë‚´ì—­
- âœ… D-1: "N+1 ì¿¼ë¦¬ í•´ê²°" ì™„ë£Œ ì²˜ë¦¬
- ğŸ“Š Phase D ì§„í–‰ë¥ : 0% â†’ 33%

### ìƒì„±ëœ ë¬¸ì„œ
- ğŸ“„ êµ¬í˜„ ë§¤ë‰´ì–¼: `docs/implemented/2026-01-31_D-1-nplusone-fix.md`

### í˜„ì¬ ìƒíƒœ
- Phase D: 33% (1/3 íƒœìŠ¤í¬)
- ë‹¤ìŒ íƒœìŠ¤í¬: D-2. ì¸ë±ìŠ¤ ìµœì í™”

### state.json ì—…ë°ì´íŠ¸
- D-1.status: "committing" â†’ "completed"
- D-1.outputs.implemented: ê²½ë¡œ ê¸°ë¡
```

### ë³€ê²½ ìš”ì•½ (Phase ì™„ë£Œ)

```markdown
## ğŸ‰ Phase D ì™„ë£Œ!

**Phase**: D. ì¿¼ë¦¬ ìµœì í™”
**ê¸°ê°„**: 2026-01-31 ~ 2026-02-01 (2ì¼)

### ì™„ë£Œëœ íƒœìŠ¤í¬
- âœ… D-1: N+1 ì¿¼ë¦¬ í•´ê²°
- âœ… D-2: ì¸ë±ìŠ¤ ìµœì í™”
- âœ… D-3: ì¿¼ë¦¬ ìºì‹±

### ìƒì„±ëœ ë¬¸ì„œ
- ğŸ“„ Phase ë§¤ë‰´ì–¼: `docs/implemented/2026-02-01_phase-d-query-optimization.md`
- ğŸ“„ ê°œë³„ íƒœìŠ¤í¬ ë¬¸ì„œ: 3ê°œ

### ì„±ê³¼ ìš”ì•½
- ì‘ë‹µ ì‹œê°„: 450ms â†’ 120ms (73% ê°œì„ )
- í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€: 82% â†’ 87%

### ë‹¤ìŒ Phase
- Phase E: ìºì‹± & ì„±ëŠ¥
```

## ìƒíƒœ ì•„ì´ì½˜

```
â¬œ ëŒ€ê¸° (pending)
ğŸ”„ ì§„í–‰ì¤‘ (planning, implementing, reviewing, committing)
âœ… ì™„ë£Œ (completed)
â¸ï¸ ë³´ë¥˜ (blocked)
âŒ ì·¨ì†Œ
```

## ì£¼ì˜ì‚¬í•­

### íŒŒì¼ ë°±ì—…
ì¤‘ìš”í•œ ë³€ê²½ ì „ ì›ë³¸ ë‚´ìš© ë³´ì¡´ ê¶Œì¥

### í¬ë§· ìœ ì§€
ê¸°ì¡´ ë¬¸ì„œì˜ ë§ˆí¬ë‹¤ìš´ í¬ë§· ìŠ¤íƒ€ì¼ ìœ ì§€

### state.json ë™ê¸°í™”
ë¬¸ì„œ ì—…ë°ì´íŠ¸ì™€ state.json ì—…ë°ì´íŠ¸ë¥¼ í•¨ê»˜ ìˆ˜í–‰
