# 개발 파이프라인 상세 워크플로우

## 전체 흐름

```
┌─────────────────────────────────────────────────────────────────┐
│                        PIPELINE START                            │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  1. 로드맵 생성/확인                                              │
│     └─ roadmap-task-splitter                                    │
│        · 기능 → Phase → Task → Subtask 분해                      │
│        · 체크리스트 형태 문서 생성                                 │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  2. TASK LOOP (각 태스크마다 반복)                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  2.1 계획 (Planning)                                     │   │
│  │      └─ reference-reader: 관련 문서 컨텍스트 추출         │   │
│  │      └─ task-implementation-planner: 구현 상세 계획       │   │
│  │                                                          │   │
│  │  출력: 구현 계획서 (.pipeline/{task-id}-plan.md)          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                  │
│                              ▼                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  2.2 구현 (Implementation)                               │   │
│  │      └─ 사용자/Claude가 직접 코드 작성                    │   │
│  │      └─ test-writer: 테스트 코드 생성 (필요시)            │   │
│  │                                                          │   │
│  │  출력: 구현 코드 + 테스트 코드                            │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                  │
│                              ▼                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  2.3 리뷰 (Review)                                       │   │
│  │      └─ code-reviewer: 코드 품질 검토                     │   │
│  │      └─ task-validator: 완료 조건 검증                    │   │
│  │                                                          │   │
│  │  출력: 리뷰 피드백                                        │   │
│  │  분기: 통과 → 커밋 / 수정필요 → 구현으로 복귀              │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                  │
│                              ▼                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  2.4 커밋 (Commit)                                       │   │
│  │      └─ commit-message-writer: 커밋 메시지 생성           │   │
│  │      └─ doc-updater: 로드맵 체크리스트 업데이트            │   │
│  │                                                          │   │
│  │  출력: 커밋 메시지, 업데이트된 로드맵                      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                  │
│                              ▼                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  2.5 전환 (Transition)                                   │   │
│  │      └─ next-task-selector: 다음 태스크 추천              │   │
│  │                                                          │   │
│  │  출력: 다음 태스크 정보                                   │   │
│  │  분기: 다음 태스크 있음 → 2.1로 / Phase 완료 → 3으로      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  3. PHASE 완료                                                   │
│     └─ phase-summary: 완료 리포트 생성                           │
│     └─ 다음 Phase 시작 또는 전체 완료                             │
└─────────────────────────────────────────────────────────────────┘
```

## 상태 전환 다이어그램

```
                    ┌─────────────────────┐
                    │      pending        │
                    │    (대기 중)         │
                    └──────────┬──────────┘
                               │ start_task
                               ▼
                    ┌─────────────────────┐
                    │     planning        │
                    │   (계획 수립 중)     │
                    └──────────┬──────────┘
                               │ plan_complete
                               ▼
         수정필요   ┌─────────────────────┐
        ┌─────────│   implementing      │
        │         │    (구현 중)         │
        │         └──────────┬──────────┘
        │                    │ code_complete
        │                    ▼
        │         ┌─────────────────────┐
        └─────────│     reviewing       │
                  │    (리뷰 중)         │
                  └──────────┬──────────┘
                             │ review_pass
                             ▼
                  ┌─────────────────────┐
                  │    committing       │
                  │   (커밋 준비 중)     │
                  └──────────┬──────────┘
                             │ committed
                             ▼
                  ┌─────────────────────┐
                  │     completed       │───► 다음 태스크
                  │      (완료)         │     (pending)
                  └─────────────────────┘
```

## 사용자 인터랙션 포인트

### 자동 진행 가능 (Claude 주도)
- 계획 수립 (planning)
- 코드 리뷰 (reviewing)
- 커밋 메시지 생성 (committing)
- 문서 업데이트
- 다음 태스크 추천

### 사용자 개입 필요
- 구현 승인 ("계획대로 구현해줘")
- 구현 완료 선언 ("구현 끝났어")
- 리뷰 피드백 반영 ("수정했어")
- 커밋 실행 ("커밋해줘" / 직접 git commit)
- 다음 태스크 시작 ("다음 태스크 시작")

## 블로커 처리

### 블로커 감지
```json
{
  "blockers": [
    {
      "type": "dependency",
      "description": "A-2는 A-1 완료 후 진행 가능",
      "blocked_task": "A-2",
      "waiting_for": "A-1"
    },
    {
      "type": "external",
      "description": "외부 API 키 필요",
      "blocked_task": "A-3",
      "action_required": "환경 변수 설정"
    }
  ]
}
```

### 블로커 시 대안
1. 의존성 없는 다른 태스크로 전환
2. 블로커 해결 후 복귀 안내
3. 보류(hold) 상태로 전환

## 롤백/재시도

### 태스크 재시작
```
사용자: "A-1 다시 시작해줘"

액션:
1. A-1 상태를 'pending'으로 리셋
2. 관련 출력물 아카이브 (.pipeline/archive/)
3. 새로운 계획부터 시작
```

### 단계 재실행
```
사용자: "리뷰 다시 해줘"

액션:
1. current_step을 'reviewing'으로 설정
2. code-reviewer 재실행
```